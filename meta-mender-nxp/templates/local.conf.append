# Appended fragment from meta-mender-community/meta-mender-nxp/templates

# Supported machines are:
#    - imx7s-warp
#    - imx7d-pico
#    - nitrogen8m
#
MACHINE ?= "imx7s-warp"

DISTRO ?= "fslc-framebuffer"

IMAGE_INSTALL_append = " kernel-image kernel-devicetree"

# Specific Configuration for Mender
MENDER_FEATURES_ENABLE_append = " mender-uboot mender-image-sd"
MENDER_FEATURES_DISABLE_append = " mender-grub mender-image-uefi"

# Specific Kernel devicetree and U-Boot Configuration for Pico-Pi i.MX7D
KERNEL_DEVICETREE_remove_imx7d-pico = "imx7d-pico-hobbit.dtb"
UBOOT_CONFIG_remove_imx7d-pico = "hobbit generic"
MENDER_UBOOT_STORAGE_INTERFACE_imx7d-pico = "mmc"
MENDER_UBOOT_STORAGE_DEVICE_imx7d-pico = "0"
MENDER_STORAGE_DEVICE_imx7d-pico = "/dev/mmcblk2"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_1_imx7d-pico = "0xC0000"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_2_imx7d-pico = "0xE0000"

# Specific Configuration for WaRP7
IMAGE_BOOT_FILES_imx7s-warp = "boot.scr"
MENDER_UBOOT_STORAGE_INTERFACE_imx7s-warp = "mmc"
MENDER_UBOOT_STORAGE_DEVICE_imx7s-warp = "0"
MENDER_STORAGE_DEVICE_imx7s-warp = "/dev/mmcblk1"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_1_imx7s-warp = "0x80000"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_2_imx7s-warp = "0xA0000"

# Specific Configuration for nitrogen8m
IMAGE_BOOT_FILES_nitrogen8m_append = " \
	upgrade.scr-${MACHINE};upgrade.scr \
	imx-boot;u-boot.${MACHINE} \
"

# Specific Configuration for imx8mqevk

# This represents booting from uSD, remove this line to build an image for eMMC
MENDER_STORAGE_DEVICE_imx8mqevk = "/dev/mmcblk1"
o
# For the i.MX8M SoC's M4 firmware is deployed to the boot partitions which
# exceed the default size of 16 GB
MENDER_BOOT_PART_SIZE_MB_imx8mqevk = "32"

MENDER_IMAGE_BOOTLOADER_FILE_imx8mqevk = "u-boot-spl.bin"
# IMX_BOOT_SEEK * 2, as argument is in blocks of 512 bytes instead of 1kB which
# is used in WIC
MENDER_IMAGE_BOOTLOADER_BOOTSECTOR_OFFSET_imx8mqevk = "66"

